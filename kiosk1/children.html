<html>
<head>
<link href="css/style.css" rel="stylesheet" type="text/css" />
<script src="data.js"></script>
<script src="js/json2.js"></script>
<script type='text/JavaScript' >
	function addChild(childName,absent)
	{
			var pinInput = document.getElementById('pinInput');	
			var childrenTable = document.getElementById('childrenTable');	
			var row = document.createElement('tr');
			var cellName = document.createElement('td');
			cellName.setAttribute('width','50%');
			var txName = document.createTextNode(childName);
			/*
			var buttonName = document.createElement('input');
			buttonName.type = 'button';
			buttonName.id = childName;
			buttonName.value = childName;
			buttonName.setAttribute('style','width:150');
			buttonName.setAttribute('onclick','window.location.replace("Child.htm?cn='+childName+'&pin='+pinInput.value+'");');
			*/

			var cellAbsent = document.createElement('td');
			var cellAbsent = document.createElement('td');
			var checkBoxAbsent = document.createElement('input');
			checkBoxAbsent.type = 'checkbox';
			checkBoxAbsent.checked = absent;
			cellAbsent.appendChild(checkBoxAbsent)
			cellName.appendChild(txName);
			row.appendChild(cellName);
			row.appendChild(cellAbsent);
			childrenTable.appendChild(row);	
	}
	
	function setChildren()
 {

	  var pinCode = getQueryString('pin'); 
	  var hiddenPin = document.getElementById('pinInput');
	  hiddenPin.value= pinCode;
	 /*
	  var Connect = new XMLHttpRequest();
	  Connect.open("GET", "data.xml", false);
	  Connect.setRequestHeader("Content-Type", "text/xml");
	  Connect.send(null);
	  var TheDocument = Connect.responseXML;
	  Connect = null;
	  var data = TheDocument.childNodes[0];
	  */
	var parent = getParentData(pinCode);
	var pin  = parent.pin;	  
	var parentName = 'Welcome ' + parent.name;
	document.getElementById('spParent').innerHTML = parentName;	  
	
	if(parent != null)
	{
	var children = parent.child;
			for (var j = 0; j < children.length; j++)
							  {
								var childName = children[j].name;
								addChild((childName),false);
							  }
			
			
	}
 }
	
	
	var getQueryString = function ( field, url ) {
    var href = url ? url : window.location.href;
    var reg = new RegExp( '[?&]' + field + '=([^&#]*)', 'i' );
    var string = reg.exec(href);
    return string ? string[1] : null;
	};

function go(val)
{
	if(val=='Cancel')
	{
		window.location.replace('Welcome.html');
		return;
	}
	
	
	if(val='Continue')
	{
		var childrenTable = document.getElementById('childrenTable');
		var childRows = childrenTable.getElementsByTagName('tr');
		var pinCode = document.getElementById('pinInput').value;
		debugger;
		
		var children = '{~children~:[';
		
		for(var i=0;i<childRows.length;i++)
		{
			var tdArr = childRows[i].getElementsByTagName('td');
			var name = tdArr[0];
			var signIn = tdArr[1].firstChild.checked;
			children = children + '{~name~:~' +name.innerHTML+'~,~signIn~:~'+signIn+'~},';
		
		}
		
		children = children.substring(0, children.length - 1);
		children = children + ']}';
		
		window.location.replace('SignIn.html?children=' + children+'&pin='+pinCode);
	}
	
}
</script>


</head>
<body >
<div class='center'>
<header>
<p><span id='spParent'/>
<span></p>
</header>
<section>
<h3>Who are you signing in today?</h3>
<input type='hidden' id='pinInput'/>
<table>
<table id='childrenTable' style='border:solid 1px' width='50%'>

</table>
<table><tr>
<td><input type='button' value='Cancel' onclick='go(this.value);'/></td>
<td></td>
<td><input type='button' value='Continue' onclick='go(this.value);'/></td>
</tr>
</table>
</section>
<script>
	setChildren();
</script>
</div>
</body>
</html>
